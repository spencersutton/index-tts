from collections.abc import Sequence
from typing import TYPE_CHECKING, Any

from gradio.blocks import BlockContext, BlockFunction, Blocks
from gradio.components import Component
from mcp import types
from mcp.server import Server
from PIL import Image
from starlette.applications import Starlette
from starlette.requests import Request
from starlette.responses import JSONResponse

if TYPE_CHECKING: ...
DEFAULT_TEMP_DIR = ...

class GradioMCPServer:
    def __init__(self, blocks: Blocks) -> None: ...
    @property
    def local_url(self) -> str | None: ...
    def get_route_path(self, request: Request) -> str: ...
    def get_selected_tools_from_request(self) -> list[str] | None: ...
    @staticmethod
    def valid_and_unique_tool_name(tool_name: str, existing_tool_names: set[str]) -> str: ...
    def get_tool_to_endpoint(self) -> dict[str, str]: ...
    def warn_about_state_inputs(self) -> None: ...
    def create_mcp_server(self) -> Server: ...
    def launch_mcp_on_sse(self, app: Starlette, subpath: str, root_path: str) -> None: ...
    def get_block_fn_from_endpoint_name(self, endpoint_name: str) -> BlockFunction | None: ...
    def get_fn_description(self, block_fn: BlockFunction, tool_name: str) -> tuple[str, dict[str, str]]: ...
    @staticmethod
    def insert_empty_state(inputs: Sequence[Component | BlockContext], data: list) -> list: ...
    @staticmethod
    def pop_returned_state(components: Sequence[Component | BlockContext], data: Any) -> list: ...
    def get_input_schema(
        self, tool_name: str, parameters: dict[str, str] | None = ...
    ) -> tuple[dict[str, Any], list[list[str | int]]]: ...
    async def get_complete_schema(self, request) -> JSONResponse: ...
    def simplify_filedata_schema(self, schema: dict[str, Any]) -> tuple[dict[str, Any], list[list[str | int]]]: ...
    def convert_strings_to_filedata(self, value: Any, filedata_positions: list[list[str | int]]) -> Any: ...
    @staticmethod
    def get_image(file_path: str) -> Image.Image | None: ...
    @staticmethod
    def get_svg(file_data: Any) -> bytes | None: ...
    @staticmethod
    def get_base64_data(image: Image.Image, format: str) -> str: ...
    def postprocess_output_data(self, data: Any, root_url: str) -> list[types.TextContent | types.ImageContent]: ...

def resource(uri_template: str, description: str | None = ..., mime_type: str | None = ...):  # -> Callable[..., Any]:

    ...
def prompt(name: str | None = ..., description: str | None = ...):  # -> Callable[..., Any]:

    ...
def tool(
    name: str | None = ...,
    description: str | None = ...,
    structured_output: bool = ...,
    _meta: dict[str, Any] | None = ...,
):  # -> Callable[..., Any]:

    ...
