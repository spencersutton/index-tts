from collections.abc import Callable, Sequence
from importlib.metadata import EntryPoint
from typing import Any, Protocol

import torch
from torch import fx

log = ...

class CompiledFn(Protocol):
    def __call__(self, *args: torch.Tensor) -> tuple[torch.Tensor, ...]: ...

type CompilerFn = Callable[[fx.GraphModule, list[torch.Tensor]], CompiledFn]
_BACKENDS: dict[str, EntryPoint | None] = ...
_COMPILER_FNS: dict[str, CompilerFn] = ...

def register_backend(
    compiler_fn: CompilerFn | None = ..., name: str | None = ..., tags: Sequence[str] = ...
) -> Callable[..., Any]: ...

register_debug_backend = ...
register_experimental_backend = ...

def lookup_backend(compiler_fn: str | CompilerFn) -> CompilerFn: ...
def list_backends(exclude_tags=...) -> list[str]: ...
