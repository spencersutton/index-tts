from collections.abc import Callable
from concurrent.futures import Future, ProcessPoolExecutor
from dataclasses import dataclass
from multiprocessing.context import BaseContext
from typing import ParamSpec, TypeVar

_P = ParamSpec("_P")
_R = TypeVar("_R")
log = ...

@dataclass
class _QueueStats:
    """_QueueStats(pending: dict[int, float] = <factory>, timing: list[float] = <factory>, enqueue_count: int = 0, dequeue_count: int = 0, max_queue_depth: int = 0, pool_count: int = 0)"""

    pending: dict[int, float] = ...
    timing: list[float] = ...
    enqueue_count: int = ...
    dequeue_count: int = ...
    max_queue_depth: int = ...
    pool_count: int = ...

_queue_stats = ...
_queue_stats_lock = ...

class TrackedProcessPoolExecutor(ProcessPoolExecutor):
    def __init__(
        self,
        max_workers: int | None = ...,
        mp_context: BaseContext | None = ...,
        initializer: Callable[[], object] | None = ...,
    ) -> None: ...
    def submit(self, fn: Callable[_P, _R], /, *args: _P.args, **kwargs: _P.kwargs) -> Future[_R]: ...
