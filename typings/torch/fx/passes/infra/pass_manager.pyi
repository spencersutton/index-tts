from collections.abc import Callable

import torch.nn as nn
from torch.fx._compatibility import compatibility
from torch.fx.passes.infra.pass_base import PassResult

logger = ...
__all__ = [
    "PassManager",
    "pass_result_wrapper",
    "this_before_that_pass_constraint",
]

@compatibility(is_backward_compatible=False)
def pass_result_wrapper(fn: Callable) -> Callable: ...
@compatibility(is_backward_compatible=False)
def this_before_that_pass_constraint(this: Callable, that: Callable) -> Callable: ...

@compatibility(is_backward_compatible=False)
class PassManager:
    passes: list[Callable[[nn.Module], PassResult]]
    constraints: list[Callable[[Callable, Callable], bool]]
    _validated: bool = ...
    steps: int = ...
    def __init__(
        self,
        passes=...,
        constraints=...,
        steps=...,
        run_checks_after_each_pass: bool = ...,
        suppress_check_failures: bool = ...,
    ) -> None: ...
    def add_pass(self, _pass: Callable) -> None: ...
    def add_constraint(self, constraint: Callable) -> None: ...
    def validate_constraints(self) -> None: ...
    def solve_constraints(self) -> None: ...
    def add_checks(self, check: Callable) -> None: ...
    def check(self, module: nn.Module) -> None: ...
    def __call__(self, module: nn.Module) -> PassResult: ...
