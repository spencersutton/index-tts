from collections.abc import Sequence
from contextlib import contextmanager

from torch import Tensor
from torch.nn.modules.container import Module, ModuleList
from torch.nn.parameter import Parameter

__all__ = [
    "ParametrizationList",
    "cached",
    "is_parametrized",
    "register_parametrization",
    "remove_parametrizations",
    "transfer_parametrizations_and_params",
    "type_before_parametrizations",
]
_cache_enabled = ...
_cache: dict[tuple[int, str], Tensor | None] = ...

@contextmanager
def cached() -> Generator[None, Any, None]: ...

class ParametrizationList(ModuleList):
    original: Tensor
    unsafe: bool
    def __init__(self, modules: Sequence[Module], original: Tensor | Parameter, unsafe: bool = ...) -> None: ...
    def right_inverse(self, value: Tensor) -> None: ...
    def forward(self) -> Tensor: ...

def register_parametrization(
    module: Module, tensor_name: str, parametrization: Module, *, unsafe: bool = ...
) -> Module: ...
def is_parametrized(module: Module, tensor_name: str | None = ...) -> bool: ...
def remove_parametrizations(module: Module, tensor_name: str, leave_parametrized: bool = ...) -> Module: ...
def type_before_parametrizations(module: Module) -> type: ...
def transfer_parametrizations_and_params(
    from_module: Module, to_module: Module, tensor_name: str | None = ...
) -> Module: ...
