import contextlib
from collections.abc import Callable
from dataclasses import dataclass
from types import ModuleType
from typing import Any, NoReturn, TypeVar
from warnings import deprecated

CONFIG_TYPES = ...
T = TypeVar("T", bound=int | float | bool | None | str | list | set | tuple | dict)
_UNSET_SENTINEL = ...

@dataclass
class _Config[T: int | float | bool | None | str | list | set | tuple | dict]:
    default: T | object
    justknob: str | None = ...
    env_name_default: list[str] | None = ...
    env_name_force: list[str] | None = ...
    alias: str | None = ...
    def __init__(
        self,
        default: T | object = ...,
        justknob: str | None = ...,
        env_name_default: str | list[str] | None = ...,
        env_name_force: str | list[str] | None = ...,
        value_type: type | None = ...,
        alias: str | None = ...,
    ) -> None: ...
    @staticmethod
    def string_or_list_of_string_to_list(val: str | list[str] | None) -> list[str] | None: ...

def Config[T: int | float | bool | None | str | list | set | tuple | dict](
    default: T | object = ...,
    justknob: str | None = ...,
    env_name_default: str | list[str] | None = ...,
    env_name_force: str | list[str] | None = ...,
    value_type: type | None = ...,
    alias: str | None = ...,
) -> T: ...
def install_config_module(module: ModuleType) -> None: ...

COMPILE_IGNORED_MARKER = ...

def get_assignments_with_compile_ignored_comments(module: ModuleType) -> set[str]: ...

@dataclass
class _ConfigEntry:
    default: Any
    value_type: type
    user_override: Any = ...
    justknob: str | None = ...
    env_value_force: Any = ...
    env_value_default: Any = ...
    hide: bool = ...
    alias: str | None = ...
    def __init__(self, config: _Config) -> None: ...

class ConfigModule(ModuleType):
    _config: dict[str, _ConfigEntry]
    _bypass_keys: set[str]
    _compile_ignored_keys: set[str]
    _is_dirty: bool
    _hash_digest: bytes | None
    def __init__(self) -> None: ...
    def __setattr__(self, name: str, value: object) -> None: ...
    def __getattr__(self, name: str) -> Any: ...
    def __delattr__(self, name: str) -> None: ...
    def get_type(self, config_name: str) -> type: ...
    def save_config(self) -> bytes: ...
    def save_config_portable(self, *, ignore_private_configs: bool = ...) -> dict[str, Any]: ...
    def codegen_config(self) -> str: ...
    def get_hash(self) -> bytes: ...
    @deprecated(
        "`config.to_dict()` has been deprecated. It no longer changes the underlying config."
        " use `config.get_config_copy()` instead if you just want a copy of the config, or "
        "config.load_config if you need mutable access",
        category=FutureWarning,
    )
    def to_dict(self) -> dict[str, Any]: ...
    @deprecated(
        "`config.shallow_copy_dict()` has been deprecated. It no longer changes the underlying config."
        " use `config.get_config_copy()` instead if you just want a copy of the config, or "
        "config.load_config if you need mutable access",
        category=FutureWarning,
    )
    def shallow_copy_dict(self) -> dict[str, Any]: ...
    def load_config(self, maybe_pickled_config: bytes | dict[str, Any]) -> None: ...
    def get_config_copy(self) -> dict[str, Any]: ...
    def patch(
        self, arg1: str | dict[str, Any] | None = ..., arg2: Any = ..., **kwargs: dict[str, Any]
    ) -> ContextDecorator: ...

class ContextDecorator(contextlib.ContextDecorator):
    def __enter__(self) -> None: ...
    def __exit__(self, exc_type, exc_val, exc_tb) -> NoReturn: ...
    def __call__(self, func: Callable[[Any], Any]) -> Any: ...

class SubConfigProxy:
    def __init__(self, config: object, prefix: str) -> None: ...
    def __setattr__(self, name: str, value: object) -> None: ...
    def __getattr__(self, name: str) -> Any: ...
    def __delattr__(self, name: str) -> None: ...

def patch_object(obj: object, name: str, value: object) -> object: ...
def get_tristate_env(name: str, default: Any = ...) -> bool | None: ...
