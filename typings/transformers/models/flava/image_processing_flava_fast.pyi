from collections.abc import Iterable
from functools import lru_cache
from typing import Any

import torch

from ...image_processing_utils_fast import BaseImageProcessorFast, BatchFeature, DefaultFastImageProcessorKwargs
from ...image_utils import ImageInput
from ...processing_utils import Unpack
from ...utils import is_torch_available, is_torchvision_available

"""Fast Image processor class for Flava."""
if is_torch_available(): ...
if is_torchvision_available(): ...

class FlavaMaskingGenerator:
    def __init__(
        self,
        input_size: int | tuple[int, int] = ...,
        total_mask_patches: int = ...,
        mask_group_max_patches: int | None = ...,
        mask_group_min_patches: int = ...,
        mask_group_min_aspect_ratio: float | None = ...,
        mask_group_max_aspect_ratio: float | None = ...,
    ) -> None: ...
    def get_shape(self):  # -> tuple[Any | int, Any | int]:
        ...
    def __call__(self):  # -> Tensor:
        ...

class FlavaFastImageProcessorKwargs(DefaultFastImageProcessorKwargs):
    return_image_mask: bool | None
    input_size_patches: int | None
    total_mask_patches: int | None
    mask_group_min_patches: int | None
    mask_group_max_patches: int | None
    mask_group_min_aspect_ratio: float | None
    mask_group_max_aspect_ratio: float | None
    return_codebook_pixels: bool | None
    codebook_do_resize: bool | None
    codebook_size: bool | None
    codebook_resample: int | None
    codebook_do_center_crop: bool | None
    codebook_crop_size: int | None
    codebook_do_rescale: bool | None
    codebook_rescale_factor: int | float | None
    codebook_do_map_pixels: bool | None
    codebook_do_normalize: bool | None
    codebook_image_mean: float | Iterable[float] | None
    codebook_image_std: float | Iterable[float] | None

class FlavaImageProcessorFast(BaseImageProcessorFast):
    resample = ...
    image_mean = ...
    image_std = ...
    size = ...
    crop_size = ...
    do_resize = ...
    do_center_crop = ...
    do_rescale = ...
    do_normalize = ...
    return_image_mask = ...
    input_size_patches = ...
    total_mask_patches = ...
    mask_group_min_patches = ...
    mask_group_max_patches = ...
    mask_group_min_aspect_ratio = ...
    mask_group_max_aspect_ratio = ...
    return_codebook_pixels = ...
    codebook_do_resize = ...
    codebook_size = ...
    codebook_resample = ...
    codebook_do_center_crop = ...
    codebook_crop_size = ...
    codebook_do_rescale = ...
    codebook_rescale_factor = ...
    codebook_do_map_pixels = ...
    codebook_do_normalize = ...
    codebook_image_mean = ...
    codebook_image_std = ...
    valid_kwargs = FlavaFastImageProcessorKwargs
    def __init__(self, **kwargs: Unpack[FlavaFastImageProcessorKwargs]) -> None: ...
    def preprocess(self, images: ImageInput, **kwargs: Unpack[DefaultFastImageProcessorKwargs]) -> BatchFeature: ...
    @classmethod
    def from_dict(cls, image_processor_dict: dict[str, Any], **kwargs):  # -> tuple[Self, dict[str, Any]] | Self:

        ...
    @lru_cache
    def masking_generator(
        self,
        input_size_patches,
        total_mask_patches,
        mask_group_min_patches,
        mask_group_max_patches,
        mask_group_min_aspect_ratio,
        mask_group_max_aspect_ratio,
    ) -> FlavaMaskingGenerator: ...
    def map_pixels(self, image: torch.Tensor) -> torch.Tensor: ...

__all__ = ["FlavaImageProcessorFast"]
